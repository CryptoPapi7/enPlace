# 2026-02-17 - enPlace Theme System Fixes

## Major Discoveries

### 1. Duplicate ProfileScreen Files
- Found TWO ProfileScreen files:
  - `/app/profile.tsx` - ACTUAL file used by Expo Router
  - `/screens/ProfileScreen.tsx` - Decoy file (not used)
- All edits were going to the wrong file until discovered

### 2. Fine-Dining Theme Has Inverted Neutral Scale
- Classic: `neutral[900]` = dark, `neutral[300]` = light
- Michelin: `neutral[900]` = WHITE, `neutral[300]` = dark graphite
- This means using `neutral[300]` for Michelin = DARK ON DARK (invisible)
- Solution: Use `neutral[900]` for primary text in BOTH themes

### 3. Theme Uses Undocumented Neutral Indices
- Fine-dining theme is MISSING `neutral[400]` and `neutral[600]`
- These return `undefined` → defaults to black
- Had to audit all screens for invalid neutral indices

## Screens Fixed

### ProfileScreen (`/app/profile.tsx`)
- Fixed: `optionLabel`, `servingText`, `toggleLabel`, `sectionSub`
- Fixed: `avatarHint`, `nicknameLabel`, `userEmail` (undefined `neutral[400]`)
- Changed all to use `neutral[900]` (primary) or `neutral[700]` (secondary)

### MyLibraryScreen
- Fixed: `backButtonText`, `title`, `searchInput`, `countText`
- Fixed: `sectionTitle`, `sectionCount`, `totalCount`
- Fixed: `recipeName`, `recipeMeta`, `emptyTitle`, `emptySubtitle`

### PlanWeekScreen
- Fixed: `backButton`, `title`, `dayName`, `mealName`
- Fixed: `moveMenuTitle`, `moveOptionName`, `modalTitle`
- Fixed: `dayOptionName`, `recipeOptionName`, `servingsValue`
- Fixed: hardcoded `#666` → `neutral[700]`
- Fixed: `emptySlot` background and border color (was white)
- Softened white text to silver (`neutral[700]`) for Michelin elegance

### RecipeScreen
- Fixed: `floatingButtonContainer` background (#FFF8E7 → theme-aware)
- Fixed: borderTopColor to use theme-appropriate neutral

### CookScreen
- Fixed: `navBar` background (`colors.white` → theme-aware)
- Fixed: borderTopColor to use neutral[700] for Michelin

### Theme Persistence (ThemeProvider)
- Removed dependency on `useAuth` (was causing circular issues)
- Now listens to Supabase auth changes directly
- Logged-in users: saves to `profiles.theme` (Supabase)
- Logged-out users: saves to `preferences` table (SQLite)

## Architecture Decision

When adding a third theme:
- Must define ALL neutral indices: 900, 700, 500, 300, 200, 100
- Primary text should ALWAYS be `neutral[900]`
- Secondary text should ALWAYS be `neutral[700]`
- Never use `neutral[300]` for text (it's LIGHT in classic, DARK in dark themes)
- Let the theme swap the color values, not the indices
- Floating containers should always use `background.primary` or `background.secondary`
